## 第三章 Array的变化侦测
#### &nbsp;&nbsp;Array的追踪变化的方式和object不一样。因为它是通过方法来改变内容的，所以我们通过创建拦截器去覆盖数组原型的方式来追踪变化。

#### &nbsp;&nbsp; 为了不污染Array.prototype， 我们在Observer中只针对那些需要侦测变化的数组使用__proto__来覆盖原型方法，但是__proto__在Es6之前并不是标准属性，不是所有的浏览器都支持，因此，针对不支持__proto__属性的浏览器，我们直接循环拦截器，把拦截器中的方法直接设置到数组身上来拦截Array.prototype上的原型方法。

#### Array收集依赖的方式和Object一样都是在getter上收集。但是由于使用依赖的位置不同，数组要在拦截器中向依赖发送消息，所以依赖不能像object那样保存在defineReative中，而是把依赖保存在了Observer实例上。

#### Observer中，我们对每个检测了变化的数据都标记上__ob__,并把this(observer实例)保存在__ob__上。这主要有两个作用，一方面是为了标记数据是否被侦测了变化(保证一个数据只被侦测一次), 另一方面可以很方便的通过数据取到__ob__，从而拿到observer实例上保存的依赖。当拦截到数组发生变化时，向依赖发送通知。

#### 除了侦测数组自身的变化外，数组的元素发生的变化也要侦测。我们在observer中判断如果当前被侦测的数据是数组，则调用observerArray方法将数组中的每一个元素都转换成响应式的并侦测变化。

#### 除了侦测已经有的数据外，当用户使用push等方法向数组中新增数据时，新增的数据也要进行变化侦测。我们使用当前操作数组的方法来进行判断，如果是push，unshift,和splice方法，则从参数中将新增数据提取出来，然后使用observerArray对新增数据进行变化侦测。

#### 由于在ES6之前，javascript并没有提供元编程的能里，所以对于数据类型的数据，一些语法无法追踪到变化，只能拦截原型上的方法，而无法拦截数组特有的语法，例如使用length清空数组的操作就无法拦截。